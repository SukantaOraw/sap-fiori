<mvc:View controllerName="northwindmasterview.controller.NorthWind_MasterView"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:tnt="sap.tnt"
    xmlns:st="sap.ui.comp.smarttable"
    xmlns:table="sap.ui.table"
    xmlns:l="sap.ui.layout"
    xmlns:uxap="sap.uxap"
    xmlns:core="sap.ui.core" height="100%" displayBlock="true" id="mainView">

    <tnt:ToolPage id="toolPage" sideExpanded="true">

        <tnt:header>
            <tnt:ToolHeader>
                <Button icon="sap-icon://menu" type="Transparent" press=".onCollapseExpandPress" />
                <Title text="Northwind App" level="H1" />

                <ToolbarSpacer />

                <Button id="themeToggleBtn" icon="sap-icon://light-mode" type="Transparent" press=".onThemeTogglePress" tooltip="Switch Theme"/>

                <Avatar id="userAvatar" initials="SO" displaySize="XS" displayShape="Circle" press=".onUserAvatarPress" class="sapUiTinyMarginEnd" />
            </tnt:ToolHeader>
        </tnt:header>

        <tnt:sideContent>
            <tnt:SideNavigation id="sideNav" expanded="true">
                <tnt:NavigationList id="navList" itemSelect="onItemSelect" selectedKey="customers">
                    <tnt:NavigationListItem id="navCustomers" text="Customers" icon="sap-icon://customer" key="customers" />
                    <tnt:NavigationListItem id="navOrders" text="Orders" icon="sap-icon://sales-order" key="orders" />
                </tnt:NavigationList>
            </tnt:SideNavigation>
        </tnt:sideContent>

        <tnt:mainContents >
            <l:Splitter id="mainSplit" height="100%" width="100%" class="sapUiTinyMarginRight">

                <l:layoutData>
                    <FlexItemData growFactor="1" />
                </l:layoutData>

                <l:contentAreas>

                    <Page id="customersPage" title="Customers" showHeader="true">

                        <layoutData>
                            <l:SplitterLayoutData id="customersLayout" resizable="true" size="30%" minSize="150px" />
                        </layoutData>

                        <ScrollContainer vertical="true" height="100%" width="100%">

                            <VBox class="">

                                <List id="customersList" items="{customersModel>/}" width="100%" showSeparators="None" class="sapUiContentPadding">

                                    <CustomListItem id="customerListItem">
                                        <Panel id="customerPanel" expandable="true" expanded="false" class="flatPanel">
                                            <headerToolbar >
                                                <OverflowToolbar id="customerToolbar" height="auto" active="true" class="sapUiTinyMarginTop sapUiTinyMarginBottom">
                                                    <Avatar id="customerAvatar" displaySize="S" showBorder="true" />
                                                    <Title id="customerTitle" text="{customersModel>CompanyName}" />
                                                    <!-- Push content to right -->
                                                    <ToolbarSpacer />
                                                    <Button id="ordersButton" type="Accept" text="Orders" press="handleOrdersPress" ariaDescribedBy="acceptButtonDescription genericButtonDescription">
                                                        <layoutData>
                                                            <FlexItemData growFactor="1" />
                                                        </layoutData>
                                                    </Button>
                                                </OverflowToolbar>
                                            </headerToolbar>
                                            <content>

                                                <VBox id="customerCardBox" class="">

                                                    <!-- ðŸ”¹ Company Section -->
                                                    <VBox id="companySection" class="">
                                                        <Text id="lblCompanyName" text="Company" class="sapUiSmallText"/>
                                                        <Text id="txtCompanyName" text="{customersModel>CompanyName}"/>
                                                    </VBox>

                                                    <HBox id="divider1" class="thinDivider sapUiTinyMarginTop sapUiTinyMarginBottom"/>

                                                    <!-- ðŸ”¹ Contact Section -->
                                                    <HBox id="contactSection" class="">

                                                        <VBox width="50%">
                                                            <Text id="lblContactName" text="Contact" class="sapUiSmallText"/>
                                                            <Text id="txtContactName" text="{customersModel>ContactName}"/>
                                                        </VBox>

                                                        <VBox width="50%">
                                                            <Text id="lblContactTitle" text="Title" class="sapUiSmallText"/>
                                                            <Text id="txtContactTitle" text="{customersModel>ContactTitle}"/>
                                                        </VBox>

                                                    </HBox>

                                                    <HBox id="divider2" class="thinDivider sapUiTinyMarginTop sapUiTinyMarginBottom"/>

                                                    <!-- ðŸ”¹ Address Section -->
                                                    <VBox id="addressSection" class="">

                                                        <Text id="lblAddress" text="Address" class="sapUiSmallText"/>

                                                        <Text id="txtAddress" text="{customersModel>Address}"/>

                                                        <Text id="txtCityRegionPostal" text="{= ${customersModel>City} 
                          + ', ' 
                          + (${customersModel>Region} ? ${customersModel>Region} + ' ' : '') 
                          + ${customersModel>PostalCode} }" class=""/>

                                                        <Text id="txtCountry" text="{customersModel>Country}"/>

                                                    </VBox>

                                                    <HBox id="divider3" class="thinDivider sapUiTinyMarginTop sapUiTinyMarginBottom"/>

                                                    <!-- ðŸ”¹ Technical / Contact Info -->
                                                    <l:Grid id="infoGrid" defaultSpan="L4 M6 S12" hSpacing="0" vSpacing="0" class="sapUiTinyMarginBottom">

                                                        <VBox>
                                                            <Text id="lblCustomerID" text="Customer ID" class="sapUiSmallText"/>
                                                            <Text id="txtCustomerID" text="{customersModel>CustomerID}"/>
                                                        </VBox>

                                                        <VBox>
                                                            <Text id="lblPhone" text="Phone" class="sapUiSmallText"/>
                                                            <Text id="txtPhone" text="{customersModel>Phone}"/>
                                                        </VBox>

                                                        <VBox>
                                                            <Text id="lblFax" text="Fax" class="sapUiSmallText"/>
                                                            <Text id="txtFax" text="{customersModel>Fax}"/>
                                                        </VBox>
                                                    </l:Grid>
                                                </VBox>
                                            </content>
                                        </Panel>
                                    </CustomListItem>

                                </List>
                            </VBox>

                        </ScrollContainer>
                    </Page>


                    <Page id="ordersPage" title="Orders" showHeader="true" visible="false">
                        <layoutData>
                            <l:SplitterLayoutData id="ordersLayout" size="20%" resizable="true" minSize="60px"/>
                        </layoutData>

                        <VBox id="ordersPageLayout" class="sapUiSmallMargin">

                            <!-- <Title text="{orderModel>/CustomerName}" level="H3" class="sapUiSmallMarginBottom"/> -->

                            <List id="ordersList" items="{orderModel>/Orders}" headerText="{orderModel>/CustomerName} Orders" width="100%" noDataText="No data">

                                <ObjectListItem title="Order {orderModel>OrderID}" type="Active" press="onOrderPress" intro="{orderModel>OrderDate}">

                                    <attributes>
                                        <ObjectAttribute text="{= ${orderModel>Order_Details}.length } Items" />
                                    </attributes>

                                </ObjectListItem>

                            </List>

                        </VBox>

                    </Page>

                    <!-- Items Page -->
                    <Page id="itemsPage" title="Order Detailed" showHeader="false" visible="false">
                        <layoutData>
                            <l:SplitterLayoutData id="itemsLayout" size="auto" resizable="true" minSize="50%"/>
                        </layoutData>

                        <uxap:ObjectPageLayout id="ObjectPageLayout" showTitleInHeaderContent="true" showEditHeaderButton="false">

                            <uxap:headerTitle>
                                <uxap:ObjectPageDynamicHeaderTitle>
                                    <uxap:expandedHeading>
                                        <Title text="Order #{itemsModel>/OrderID}" wrapping="true" class=""/>
                                    </uxap:expandedHeading>

                                    <uxap:snappedHeading>
                                        <Title text="Order #{itemsModel>/OrderID}" wrapping="true"/>
                                    </uxap:snappedHeading>


                                </uxap:ObjectPageDynamicHeaderTitle>
                            </uxap:headerTitle>

                            <uxap:headerContent>
                                <FlexBox wrap="Wrap" fitContainer="true" alignItems="Start">
                                    <VBox class="sapUiMediumMarginEnd">
                                        <Title text="Summary" class="" />

                                        <HBox alignItems="Center">
                                            <Label text="Total Line Items:" class="sapUiTinyMarginEnd" />
                                            <ObjectStatus text="{= ${itemsModel>/Order_Details}.length }" state="Information" />
                                        </HBox>

                                    </VBox>

                                    <VBox class="sapUiSmallMarginEnd">
                                        <Title text="Status" class="" />
                                        <ObjectStatus text="Shipped" state="Success" icon="sap-icon://shipping-status"/>
                                    </VBox>
                                </FlexBox>
                            </uxap:headerContent>

                            <uxap:sections>

                                <uxap:ObjectPageSection showTitle="false" class="myNoPaddingSection sapUiNoMarginTop sapUiNoVerticalContentPadding">

                                    <uxap:ObjectPageSubSection class="myNoPaddingSection sapUiNoMarginTop sapUiNoVerticalContentPadding" showTitle="false" >
                                        <uxap:blocks>

                                            <st:SmartTable id="smartTable" header="Products" showRowCount="true" useTablePersonalisation="true" showFullScreenButton="true" enableAutoBinding="false" entitySet="LineItems">

                                                <Table id="itemsTable" inset="false" items="{itemsModel>/Order_Details}" sticky="ColumnHeaders,HeaderToolbar" growing="true" growingThreshold="10">

                                                    <columns>

                                                        <Column width="12rem">
                                                            <customData>
                                                                <core:CustomData key="p13nData" value='\{"columnKey": "Product/ProductName", "leadingProperty": "Product/ProductName", "sortProperty": "Product/ProductName", "filterProperty": "Product/ProductName"}' />
                                                            </customData>
                                                            <Text text="Product" />
                                                        </Column>

                                                        <Column minScreenWidth="Tablet" demandPopin="true">
                                                            <customData>
                                                                <core:CustomData key="p13nData" value='\{"columnKey": "ProductID", "leadingProperty": "ProductID"}' />
                                                            </customData>
                                                            <Text text="ID / Supplier" />
                                                        </Column>

                                                        <Column minScreenWidth="Desktop" demandPopin="true">
                                                            <customData>
                                                                <core:CustomData key="p13nData" value='\{"columnKey": "Product/QuantityPerUnit", "leadingProperty": "Product/QuantityPerUnit"}' />
                                                            </customData>
                                                            <Text text="Packaging" />
                                                        </Column>

                                                        <Column hAlign="End">
                                                            <customData>
                                                                <core:CustomData key="p13nData" value='\{"columnKey": "UnitPrice", "leadingProperty": "UnitPrice", "sortProperty": "UnitPrice"}' />
                                                            </customData>
                                                            <Text text="Price" />
                                                        </Column>

                                                        <Column hAlign="Center">
                                                            <customData>
                                                                <core:CustomData key="p13nData" value='\{"columnKey": "Quantity", "leadingProperty": "Quantity", "sortProperty": "Quantity"}' />
                                                            </customData>
                                                            <Text text="Qty" />
                                                        </Column>

                                                        <Column minScreenWidth="Tablet" demandPopin="true" hAlign="End">
                                                            <customData>
                                                                <core:CustomData key="p13nData" value='\{"columnKey": "Discount", "leadingProperty": "Discount"}' />
                                                            </customData>
                                                            <Text text="Discount" />
                                                        </Column>

                                                        <Column hAlign="End">
                                                            <customData>
                                                                <core:CustomData key="p13nData" value='\{"columnKey": "Total", "leadingProperty": "Total"}' />
                                                            </customData>
                                                            <Text text="Total" />
                                                        </Column>
                                                    </columns>

                                                    <items>
                                                        <ColumnListItem>
                                                            <cells>
                                                                <ObjectIdentifier title="{itemsModel>Product/ProductName}" text="Category: {itemsModel>Product/CategoryID}"/>

                                                                <VBox>
                                                                    <Text text="ID: {itemsModel>ProductID}" class="sapUiTinyMarginBottom"/>
                                                                    <Text text="Supp: {itemsModel>Product/SupplierID}" class="sapUiTinyMarginBottom"/>
                                                                </VBox>

                                                                <Text text="{itemsModel>Product/QuantityPerUnit}" />

                                                                <ObjectNumber number="{ path: 'itemsModel>UnitPrice', type: 'sap.ui.model.type.Float', formatOptions: {minFractionDigits: 2, maxFractionDigits: 2} }" unit="EUR" />

                                                                <ObjectNumber number="{itemsModel>Quantity}" state="Success" />

                                                                <Text text="{= ${itemsModel>Discount} * 100 } %" />

                                                                <ObjectNumber number="{= (parseFloat(${itemsModel>UnitPrice}) * ${itemsModel>Quantity}).toFixed(2) }" unit="EUR" state="Information" emphasized="true"/>
                                                            </cells>
                                                        </ColumnListItem>
                                                    </items>

                                                </Table>

                                            </st:SmartTable>

                                        </uxap:blocks>
                                    </uxap:ObjectPageSubSection>

                                </uxap:ObjectPageSection>

                            </uxap:sections>

                        </uxap:ObjectPageLayout>

                    </Page>

                </l:contentAreas>

            </l:Splitter>
        </tnt:mainContents>
    </tnt:ToolPage>

</mvc:View>